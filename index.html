 <!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gundam Battle Gunpla Warfare - Calculator</title>
<style>
	* {
		box-sizing: border-box;
		color: #232222;
		font-family: Verdana;
		font-size: 14px;
		line-height: 1.6;
	}
	h3 {
		background: #0000ff;
		color: #fff;
		font-size: 16px;
		font-weight: normal;
		margin: 0;
	}
	.container {display: flex; flex-flow: no-wrap;}
	.info {width: 200px;}
	
	.info > div {margin-right:20px;}
	.parameters > *,
	.active-word-tag > * {padding: 0 10px;}
	.parameters > div:nth-of-type(even),
	.active-word-tag > div:nth-of-type(even) {background: #f2f7f4;}
	.parameters > div > * {display: inline-block; width: 50%;}
	.parameters > div > span {text-align: right;}
	
	.parts > div { padding: 5px 0;}
	.parts > div > label {display: inline-block; width: 100px;}
	.parts > div > select {margin-right: 10px; width: 200px;}
</style>
</head>

<body>
<h1>GBGW Calculator</h1>
<div class="container">
	<div class="info">
		<div class="parameters">
			<h3>Parameters</h3>
			<div><label>Armor</label><span class="js-total-a">0</span></div>
			<div><label>Melee ATK</label><span class="js-total-ma">0</span></div>
			<div><label>Shot ATK</label><span class="js-total-sa">0</span></div>
			<div><label>Melee DEF</label><span class="js-total-md">0</span></div>
			<div><label>Shot DEF</label><span class="js-total-sd">0</span></div>
			<div><label>Beam RES</label><span class="js-total-br">0</span></div>
			<div><label>Phys. RES</label><span class="js-total-pr">0</span></div>
		</div>
		<div class="active-word-tag">
			<h3>Active Word Tag</h3>
			<div>&nbsp;</div>
			<div>&nbsp;</div>
			<div>&nbsp;</div>
		</div>
	</div>
	<div class="parts">
		<div><label>Head</label><select class="js-select-head"><option></option></select><span class="js-skill-trait"></span></div>
		<div><label>Torso</label><select class="js-select-torso"><option></option></select><span class="js-skill-trait"></span></div>
		<div><label>Arms</label><select class="js-select-arms"><option></option></select><span class="js-skill-trait"></span></div>
		<div><label>Legs</label><select class="js-select-legs"><option></option></select><span class="js-skill-trait"></span></div>
		<div><label>Backpack</label><select class="js-select-backpack"><option></option></select><span class="js-skill-trait"></span></div>
		<div><label>Melee</label><select class="js-select-melee"><option></option></select><span class="js-skill-trait"></span></div>
		<div><label>Range</label><select class="js-select-range"><option></option></select><span class="js-skill-trait"></span></div>
		<div><label>Shield</label><select class="js-select-shield"><option></option></select><span class="js-skill-trait"></span></div>
		<div><label>Pilot</label><select class="js-select-pilot"><option></option></select><span class="js-skill-trait"></span></div>
		<div class="attribute-tally">
			<label>[P] <span class="js-tally-p">0</span></label>
			<label>[T] <span class="js-tally-t">0</span></label>
			<label>[S] <span class="js-tally-s">0</span></label>
		</div>
	</div>
</div>

<script>
	const wt = ["Protag.","Mass P.","Ace Excl.","Amphib.","Commander","Close Combat","Mid-Range","Long-Shoter","High Mobility"," High Firepower","Heavy Armor","Transformer","Gudam Type","Mobile Fighter","Support Type","Federation","Zeon","Zaku Type","GM Type","For Space","For Dessert","For Tundra","For Forest","For Urban Area","For Base","For Computers"];
	const t = ["Power", "Technique", "Speed"];
	const ex = ["EX Skill", "Part Traits"];
	const parameters = ["a", "ma", "sa", "md", "sd", "br", "pr"];
	const damageType = ["Beam ", "Physical"];
	const parts = ["head", "torso", "arms", "legs", "backpack", "melee", "range", "shield", "pilot"];
	const jobLicense = ["All-Rounder", "Defender", "In-Fighter", "Out-Fighter", "Middle-Shooter", "Long-Shooter", "Supporter"];
	const mobileSuits = [
		{
			"name":"Aegis Gundam",
			"attribute":"Speed",
			"parts":[
				{"part":"head", "a":1181, "ma":384, "sa":2380, "md": 384, "sd":384, "br":213, "pr":417, "wt":["Transformer", "High Mobility"], "ex":{"type":"EX Skill", "name":"Igelstellung"}},
				{"part":"torso", "a":1977, "ma":384, "sa":796, "md":796, "sd":796, "br":0, "pr":661, "wt":["Transformer", "High Mobility"], "ex":{"type":"Part Traits", "name":"When Armor is 40% or more, Shooting DMG taken reduced by 8-35"}},
				{"part":"arms", "a":1181, "ma":796, "sa":796, "md":1181, "sd":1181, "br":0, "pr":0, "wt":["Transformer", "High Mobility"], "ex":{"type":"EX Skill", "name":"Assault Cyclone"}},
				{"part":"legs", "a":1181, "ma":384, "sa":384, "md":796, "sd":1181, "br":417, "pr":611, "wt":["Transformer", "Gudam Type"], "ex":{"type":"EX Skill", "name":"Kick Combination"}},
				{"part":"backpack", "a":1181, "ma":384, "sa":384, "md":796, "sd":1181, "br":417, "pr":611, "wt":["Transformer", "Gudam Type"], "ex":{"type":"Part Traits", "name":"When Armor is 40% or more, Enemy Sp. Shot power reduced 17-30%"}},
				{"part":"range", "a":1181, "ma":0, "sa":3177, "md":0, "sd":0, "br":213, "pr":611, "wt":["Transformer", "For Base"], "ex":{"type":"Part Traits", "name":"Out-Fighter Job, Enemy Shooting power reduced 17-30%"}, "name":"60mm High-Energy Beam Rifle", "type":"Beam"},
				{"part":"shield", "a":1181, "ma":0, "sa":0, "md":796, "sd":1602, "br":213, "pr":806, "wt":["Transformer", "Gudam Type"], "ex":{"type":"EX Skill", "name":"Shield Throw"}, "name":"Anti-Beam Shield"},
			]
		},
		{
			"name":"Gundam",
			"attribute":"Technique",
			"parts":[
				{"part":"head", "a":796, "ma":383, "sa":2378, "md":796, "sd":796, "br":212, "pr":212, "wt":["Protag.", "Gudam Type"], "ex":{"type":"EX Skill", "name":"Head-Mounted Vulcan"}},
				{"part":"torso", "a":1602, "ma":383, "sa":383, "md":1180, "sd":1180, "br":288, "pr":288, "wt":["Protag.", "Gudam Type"], "ex":{"type":"Part Traits", "name":"With Saber category equipped, Melee power boosted 17-30%"}},
				{"part":"arms", "a":796, "ma":2378, "sa":383, "md":1180, "sd":1180, "br":0, "pr":0, "wt":["Protag.", "Close Combat"], "ex":{"type":"Part Traits", "name":"With Technique attribute (self), Melee DMG taken reduced by 8-35"}},
				{"part":"legs", "a":796, "ma":383, "sa":383, "md":1180, "sd":1180, "br":475, "pr":502, "wt":["Protag.", "Close Combat"], "ex":{"type":"Part Traits", "name":"With Technique attribute (self), Mid Shot Attack raised 8-20%"}},
				{"part":"backpack", "a":796, "ma":383, "sa":383, "md":1180, "sd":1180, "br":502, "pr":475, "wt":["Protag.", "Gudam Type"], "ex":{"type":"EX Skill", "name":"Double Saber Rush"}},
				{"part":"melee", "a":796, "ma":3176, "sa":0, "md":0, "sd":0, "br":417, "pr":417, "wt":["Protag.", "Close Combat"], "ex":{"type":"EX Skill", "name":"Crimson Stinger"}, "name":"Beam Javelin", "type":"Beam"},
				{"part":"melee", "a":796, "ma":3176, "sa":0, "md":0, "sd":0, "br":417, "pr":417, "wt":["Protag.", "Close Combat"], "ex":{"type":"Part Traits", "name":"With Technique attribute (self), Melee Crit rate boosted 10-30%"}, "name":"Beam Saber", "type":"Beam"},
				{"part":"range", "a":796, "ma":0, "sa":3176, "md":0, "sd":0, "br":417, "pr":417, "wt":["Protag.", "Mid-Range"], "ex":{"type":"EX Skill", "name":"Last Shooting"}, "name":"Beam Rifle", "type":"Beam"},
				{"part":"range", "a":796, "ma":0, "sa":3176, "md":0, "sd":0, "br":417, "pr":417, "wt":["Protag.", "Mid-Range"], "ex":{"type":"Part Traits", "name":"With Technique attribute (self), Shooting DMG output boosted by 8-35"}, "name":"Hyper Bazooka", "type":"Physical"},
				{"part":"shield", "a":796, "ma":0, "sa":0, "md":1602, "sd":1602, "br":417, "pr":417, "wt":["Protag.", "Close Combat"], "ex":{"type":"Part Traits", "name":"With Technique attribute (self), Buff EX Skill effect up 4-22%"}, "name":"Shield"},
			]
		},
		{
			"name":"Gundam Barbatos",
			"attribute":"Power",
			"parts":[
				{"part":"head", "a":335, "ma":162, "sa":830, "md": 162, "sd":496, "br":172, "pr":91, "wt":["Protag.", "For Forest"], "ex":{"type":"Part Traits", "name":"With Power attribute (self), Close Shot Attack raised 8-20%"}},
				{"part":"torso", "a":496, "ma":335, "sa":162, "md": 335, "sd":678, "br":266, "pr":0, "wt":["Protag.", "For Forest"], "ex":{"type":"EX Skill", "name":"Fearless Hurl"}},
				{"part":"arms", "a":799, "ma":2786, "sa":384, "md":799, "sd":1182, "br":0, "pr":0, "wt":["Protag.", "Close Combat"], "ex":{"type":"Part Traits", "name":"In-fighter Job, Melee power boosted 17-30%"}},
				{"part":"legs", "a":799, "ma":384, "sa":384, "md":384, "sd":1182, "br":612, "pr":420, "wt":["Protag.", "Close Combat"], "ex":{"type":"EX Skill", "name":"Menace Shot"}},
				{"part":"backpack", "a":799, "ma":384, "sa":384, "md":384, "sd":1182, "br":612, "pr":420, "wt":["Protag.", "Close Combat"], "ex":{"type":"Part Traits", "name":"With Power attribute (self), Melee DMG output boosted by 8-35"}},
				{"part":"melee", "a":384, "ma":3586, "sa":0, "md":0, "sd":799, "br":420, "pr":213, "wt":["Protag.", "For Forest"], "ex":{"type":"Part Traits", "name":"In-Fighter Job, Melee CRIT rate boosted 10-30%"}, "name":"Long Sword", "type":"Physical"},
				{"part":"melee", "a":384, "ma":3586, "sa":0, "md":0, "sd":799, "br":420, "pr":213, "wt":["Protag.", "For Forest"], "ex":{"type":"EX Skill", "name":"Iron Impact"}, "name":"Mace", "type":"Physical"},
				{"part":"range", "a":799, "ma":0, "sa":1979, "md":0, "sd":799, "br":612, "pr":213, "wt":["Protag.", "For Forest"], "ex":{"type":"Part Traits", "name":"With Power attribute (self), CLose Shot Attack raised 8-20%"}, "name":"Smoothbore Cannon", "type":"Physical"},
			]
		}
	];
	
	const pilots = [
		{"name":"Athrun Zala", "jl":"In-Fighter", "attribute":"Speed", "a":799, "ma":1182, "sa":384, "md":799, "sd":1182, "br":612, "pr":213, "wt":["Transformer", "Mid-Range"], "ex":{"type":"Part Traits", "name":"20% chance to prevent vernier consumption when stepping"}},
	];
	
	/** sample
	
	{
		"name":"",
		"attribute":"",
		"parts":[
			{"part":"head", "a":0, "ma":0, "sa":0, "md":0, "sd":0, "br":0, "pr":0, "wt":["", ""], "ex":{"type":"", "name":""}},
			{"part":"torso", "a":0, "ma":0, "sa":0, "md":0, "sd":0, "br":0, "pr":0, "wt":["", ""], "ex":{"type":"", "name":""}},
			{"part":"arms", "a":0, "ma":0, "sa":0, "md":0, "sd":0, "br":0, "pr":0, "wt":["", ""], "ex":{"type":"", "name":""}},
			{"part":"legs", "a":0, "ma":0, "sa":0, "md":0, "sd":0, "br":0, "pr":0, "wt":["", ""], "ex":{"type":"", "name":""}},
			{"part":"backpack", "a":0, "ma":0, "sa":0, "md":0, "sd":0, "br":0, "pr":0, "wt":["", ""], "ex":{"type":"", "name":""}},
			{"part":"melee", "a":0, "ma":0, "sa":0, "md":0, "sd":0, "br":0, "pr":0, "wt":["", ""], "ex":{"type":"", "name":""}, "name":"", "type":""},
			{"part":"range", "a":0, "ma":0, "sa":0, "md":0, "sd":0, "br":0, "pr":0, "wt":["", ""], "ex":{"type":"", "name":""}, "name":"", "type":""},
			{"part":"shield", "a":0, "ma":0, "sa":0, "md":0, "sd":0, "br":0, "pr":0, "wt":["", ""], "ex":{"type":"", "name":""}, "name":""},
		]
	},
	
	{"name":"", "jl":"", "attribute":"", "a":0, "ma":0, "sa":0, "md": 0, "sd":0, "br":0, "pr":0, "wt":["", ""], "ex":{"type":"", "name":""}}
	
	*/
	
	class GBWB_Calculator {
		constructor() {
			this.selects = {};
			
			parts.forEach((part) => {
				this.selects[part] = document.querySelector(`.js-select-${part}`);
			});
		}
		
		init() {
			this._generateOptions();
			this._initSelectOnchange();
		}
		
		_generateOptions() {
			const s = this.selects;
		
			if(mobileSuits && Array.isArray(mobileSuits)) {
				mobileSuits.forEach((ms) => {
					if("parts" in ms && Array.isArray(ms.parts)) {
						ms.parts.forEach((p) => {
							const o = document.createElement('option');
							o.text = "[" + ms.attribute.charAt(0) + "] " + ms.name + ("name" in p ? " ("+p.name+")" : "");
							o.dataset["attribute"] = ms.attribute;
							for(let k in p) {
								if(p.hasOwnProperty(k)) {
									o.dataset[k] = p[k] instanceof Object ? JSON.stringify(p[k]) : p[k];
								}
							}
							if(p.part in s && s[p.part]) {
								s[p.part].appendChild(o);
							}
						});
					}
				});
			}
			
			if(pilots && Array.isArray(pilots)) {
				pilots.forEach((p) => {
					const o = document.createElement('option');
					o.text = "[" + p.attribute.charAt(0) + "] " + p.name;
					for(let k in p) {
						if(p.hasOwnProperty(k)) {
							o.dataset[k] = p[k] instanceof Object ? JSON.stringify(p[k]) : p[k];
						}
					}
					if("pilot" in s && s.pilot) {
						s.pilot.appendChild(o);
					}
				});
			}
		}
		
		_initSelectOnchange() {			
			const ss = this.selects;
			
			for(let k in ss) {
				if(ss.hasOwnProperty(k)) {
					ss[k].addEventListener('change', (e) => {
						this._displaySkillTraits(e);
						this._calculateParameters();
						this._displayAttributeTally();
					});
				}
			}
			
		}
		
		_calculateParameters() {
			const t = {},
				ss = this.selects;
			
			parameters.forEach((p) => {
				t[p] = 0;
			});
			
			for(let k in ss) {
				if(ss.hasOwnProperty(k)) {
					const s = ss[k];
					if(s.options.length) {
						const o = s.options[s.selectedIndex];
						parameters.forEach((p) => {
							if(o.dataset[p]) {
								t[p] += +o.dataset[p];
							}
						});
					}
				}
			}
			
			for(var k in t) {
				document.querySelector(`.js-total-${k}`).textContent = t[k];
			}
		}
		
		_displaySkillTraits(e) {
			const s = e.currentTarget,
				skillTraitCont = s.nextElementSibling;
			let ex;
			
			if(s.options.length && s.options[s.selectedIndex].dataset.ex) {
				ex = JSON.parse(s.options[s.selectedIndex].dataset.ex);
				
				skillTraitCont.textContent = `${ex.type}: ${ex.name}`;
			}
			else {
				skillTraitCont.textContent = "";
			}
		}
		
		_displayAttributeTally() {
			const attributesTally = {"p":0, "t":0, "s":0},
				ss = this.selects;
			
			for(let k in ss) {
				if(ss.hasOwnProperty(k)) {
					const o = this._getSelectedOption(ss[k]);
					
					if(o && o.dataset.attribute && o.dataset.attribute.charAt(0).toLowerCase() in attributesTally) {
						attributesTally[o.dataset.attribute.charAt(0).toLowerCase()]++;
					}
				}
			}
			
			for(let k in attributesTally) {
				document.querySelector(`.js-tally-${k}`).textContent = attributesTally[k];
			}
		}
		
		_getSelectedOption(select) {
			if(select.options.length) {
				return select.options[select.selectedIndex];
			}
			
			return false;
		}
	}
	
	(new GBWB_Calculator()).init();
</script>
</body>

</html> 